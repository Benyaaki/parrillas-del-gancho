<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parrillas del Gancho – Donde nace el fuego del asado</title>
  <link rel="icon" type="image/png" href="img/logo.png">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Google Font (opcional) -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto:wght@400;700&display=swap"
    rel="stylesheet">
  <style>
    /* Paleta fuego */
    :root {
      --fire-red: #d7261e;
      --fire-orange: #f46b1b;
      --fire-yellow: #ffc300;
      --charcoal: #1b1b1b;
      --white: #ffffff;
    }

    /* Color de texto */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--charcoal);
      color: var(--white);
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: 'Oswald', sans-serif;
      text-transform: uppercase;
    }

    /* Navbar */
    .navbar {
      background-color: var(--charcoal);
    }

    .navbar-brand span {
      color: var(--fire-red);
      font-family: 'Oswald', sans-serif;
      font-weight: 700;
      font-size: 2.25rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      line-height: 1;
    }

    @media (max-width: 768px) {
      .navbar-brand span {
        font-size: 1.8rem;
      }
    }

    .btn-cotizar {
      background: var(--fire-red);
      border: none;
      color: var(--white);
      transition: 0.3s;
    }

    .btn-cotizar:hover {
      background: var(--fire-orange);
    }

    /* Hero (Sección Principal) */
    .hero {
      /* Fondo negro con opacidad + gradiente fuego sobre la imagen */
      background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(215, 38, 30, 0.5)), url('img/fondohero.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: var(--white);
      text-align: center;
      padding: 100px 20px;
    }

    .navbar-logo {
      max-height: 80px;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
    }

    @media (max-width: 768px) {
      .navbar-logo {
        max-height: 55px;
      }
    }

    /* Productos */
    .card {
      background-color: #2a2a2a;
      border: 1px solid transparent;
      transition: 0.3s;
      overflow: hidden;
      /* Asegura que la imagen respete bordes */
    }

    .card:hover {
      border-color: var(--fire-orange);
      box-shadow: 0 0 15px rgba(244, 107, 27, 0.5);
    }

    .product-img {
      height: 220px;
      object-fit: cover;
      width: 100%;
    }

    .card-body {
      color: var(--white);
    }

    .price-text {
      color: var(--fire-yellow);
      font-weight: 700;
      font-size: 1.25rem;
    }

    /* Beneficios */
    .benefit-icon {
      font-size: 2.5rem;
      color: var(--fire-yellow);
    }

    /* Sobre Nosotros */
    .about-img {
      width: 100%;
      min-height: 300px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .product-img:hover {
      transform: scale(1.02);
      opacity: 0.95;
    }

    .extra-parrilla {
      display: none;
    }

    /* CTA WhatsApp */
    .cta-whatsapp {
      /* Fondo negro con opacidad + gradiente fuego sobre la imagen igual que hero */
      background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(215, 38, 30, 0.5)), url('img/fondohero.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: var(--white);
      text-align: center;
      padding: 120px 20px;
    }

    .cta-whatsapp h2 {
      font-family: 'Oswald', sans-serif;
      text-transform: uppercase;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
    }

    .btn-custom-cta {
      background-color: var(--white);
      color: var(--fire-red);
      font-weight: bold;
      border: none;
      padding: 10px 25px;
      font-size: 1.2rem;
      border-radius: 50px;
      transition: all 0.3s ease;
    }

    .btn-custom-cta:hover {
      transform: scale(1.05);
      background-color: var(--fire-yellow);
      color: var(--charcoal);
    }

    /* Contacto */
    .contact-section {
      background-color: #2a2a2a;
      padding: 60px 20px;
    }

    /* Footer */
    footer {
      background-color: var(--charcoal);
      color: var(--white);
      text-align: center;
      padding: 30px;
      border-top: 2px solid var(--fire-red);
    }

    /* Mejoras para Móvil */
    @media (max-width: 768px) {

      .carousel-control-prev,
      .carousel-control-next {
        display: none;
      }
    }
  </style>
</head>

<body>

  <!-- Navbar fija -->
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="img/logo.png" alt="Parrillas del Gancho Logo" class="navbar-logo img-fluid me-2">
        <span>Parrillas del Gancho</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav me-3">
          <li class="nav-item"><a class="nav-link" href="#inicio">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="#parrillas">Parrillas</a></li>
          <li class="nav-item"><a class="nav-link" href="#productos">Productos</a></li>
          <li class="nav-item"><a class="nav-link" href="#nosotros">Nosotros</a></li>
          <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
        </ul>
        <a href="#contacto" class="btn btn-cotizar">Cotiza tu parrilla</a>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section id="inicio" class="hero">

    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="6000">
      <div class="carousel-inner">
        <!-- Carrusel 1 -->
        <div class="carousel-item active">
          <div class="container">
            <h1 class="display-4 fw-bold">El fuego que une a los buenos asados</h1>
            <p class="lead mb-4">Parrillas diseñadas con pasión, fuerza y tradición chilena.</p>
          </div>
        </div>
        <!-- Carrusel 2 -->
        <div class="carousel-item">
          <div class="container">
            <h1 class="display-4 fw-bold">¿Sabías que?</h1>
            <p class="lead mb-4">El secreto de un buen asado no es solo la carne, es la paciencia y la compañía.</p>
          </div>
        </div>
        <!-- Carrusel 3 -->
        <div class="carousel-item">
          <div class="container">
            <h1 class="display-4 fw-bold">Tips de Maestro</h1>
            <p class="lead mb-4">Nunca pinches la carne al darla vuelta, usa tenazas para mantener sus jugos.</p>
          </div>
        </div>
        <!-- Carrusel 4 -->
        <div class="carousel-item">
          <div class="container">
            <h1 class="display-4 fw-bold">Tradición y Calidad</h1>
            <p class="lead mb-4">Nuestras parrillas están hechas para durar generaciones, igual que tus historias.</p>
          </div>
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
      </button>
    </div>

    <div class="container mt-4">
      <a href="#parrillas" class="btn btn-light me-2">Ver Parrillas</a>
      <a href="#contacto" class="btn btn-outline-light">Contáctanos</a>
    </div>
    <div class="mt-4">
      <i class="bi bi-flame" style="font-size:3rem;color:var(--fire-yellow);"></i>
    </div>

  </section>

  <!-- Productos Destacados -->
  <section id="parrillas" class="py-5">
    <div class="container text-center">
      <h2 class="mb-4 text-warning">Parrillas Destacadas</h2>
      <!-- Contenedor Dinámico Parrillas -->
      <div id="parrillas-container" class="row g-4">
        <!-- Cargando... -->
        <div class="text-center text-white">
          <div class="spinner-border text-warning" role="status"></div> Cargando parrillas...
        </div>
      </div>

      <!-- Botones Ver Más / Ver Menos (Controlado por JS) -->
      <div class="mt-4" id="viewMoreControls" style="display:none;">
        <button id="btnVerMas" class="btn btn-outline-warning btn-lg">Ver más modelos</button>
        <button id="btnVerMenos" class="btn btn-outline-secondary btn-lg" style="display: none;">Ver menos
          modelos</button>
      </div>
    </div>
  </section>

  <!-- Otros Productos -->
  <section id="productos" class="py-5 bg-dark">
    <div class="container text-center">
      <h2 class="text-warning mb-4">Artículos Parrilleros</h2>
      <p>Utensilios, carbón, accesorios y más para complementar tu experiencia de asado.</p>
      <!-- Contenedor Dinámico Artículos -->
      <div id="articulos-container" class="row g-4 mt-2 justify-content-center">
        <!-- Cargando... -->
      </div>
    </div>
  </section>

  <!-- Beneficios -->
  <section class="py-5 text-center">
    <div class="container">
      <h2 class="text-warning mb-5">¿Por qué elegirnos?</h2>
      <div class="row g-4">
        <div class="col-md-3"><i class="bi bi-fire benefit-icon"></i>
          <p>Alta resistencia al calor</p>
        </div>
        <div class="col-md-3"><i class="bi bi-tools benefit-icon"></i>
          <p>Fabricación sólida</p>
        </div>
        <div class="col-md-3"><i class="bi bi-flag benefit-icon"></i>
          <p>Hecho para parrilleros chilenos</p>
        </div>
        <div class="col-md-3"><i class="bi bi-chat-dots-fill benefit-icon"></i>
          <p>Atención cercana</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Sobre Nosotros -->
  <section id="nosotros" class="py-5 text-center bg-dark">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <h2 class="text-warning mb-3" style="font-size: 2.5rem;">Nuestra Pasión
          </h2>
          <p class="lead">En <strong>Parrillas del Gancho</strong>, creemos que cada asado une a las personas.
            Fabricamos parrillas
            con amor por el fuego y la buena comida.</p>
          <p class="mb-5">Más de 5 años construyendo confianza, calidad y experiencias que duran toda la vida.</p>

          <!-- Estadísticas -->
          <div class="row g-4 mt-4">
            <div class="col-md-4">
              <h3 class="text-warning display-5 fw-bold">+500</h3>
              <p>Parrillas Fabricadas</p>
            </div>
            <div class="col-md-4">
              <h3 class="text-warning display-5 fw-bold">+600</h3>
              <p>Clientes Felices</p>
            </div>
            <div class="col-md-4">
              <h3 class="text-warning display-5 fw-bold">+500</h3>
              <p>Pedidos Entregados</p>
            </div>
          </div>

        </div>
      </div>
  </section>

  <!-- CTA con Carrusel de Redes Sociales -->
  <section class="cta-whatsapp">
    <div id="ctaCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="6000">
      <div class="carousel-inner">

        <!-- Carrusel 1: WhatsApp -->
        <div class="carousel-item active">
          <div class="container">
            <h2>¿Listo para llevar tu asado al siguiente nivel?</h2>
            <p class="lead text-light mb-4">Cotiza esa parrilla soñada o resuelve tus dudas directamente con nuestro
              equipo.</p>
            <a href="https://wa.me/56984093394" target="_blank" class="btn btn-custom-cta mt-3">
              <i class="bi bi-whatsapp"></i> Escríbenos por WhatsApp
            </a>
          </div>
        </div>

        <!-- Carrusel 2: Facebook -->
        <div class="carousel-item">
          <div class="container">
            <h2>Síguenos en Facebook</h2>
            <p class="lead text-light mb-4">Únete a nuestra comunidad, comparte tus asados y no te pierdas nuestras
              novedades.</p>
            <a href="https://www.facebook.com/share/1C2gVS542e/?mibextid=wwXIfr" target="_blank"
              class="btn btn-custom-cta mt-3">
              <i class="bi bi-facebook"></i> Seguir en Facebook
            </a>
          </div>
        </div>

        <!-- Carrusel 3: Instagram -->
        <div class="carousel-item">
          <div class="container">
            <h2>Mira nuestros trabajos en Instagram</h2>
            <p class="lead text-light mb-4">Descubre fotos exclusivas de nuestros modelos, clientes felices y procesos
              de
              fabricación.</p>
            <a href="https://www.instagram.com/parrillas_del_gancho?igsh=ZzQxNGdiMnVjZnk4" target="_blank"
              class="btn btn-custom-cta mt-3">
              <i class="bi bi-instagram"></i> Seguir en Instagram
            </a>
          </div>
        </div>

        <!-- Carrusel 4: tiktok -->
        <div class="carousel-item">
          <div class="container">
            <h2>Se parte de nuestro Tiktok</h2>
            <p class="lead text-light mb-4">Podrás ver videos sobre nuestro trabajo y participacion en diferentes
              tipos
              de
              eventos.</p>
            <a href="https://www.tiktok.com/@parrillasdelgancho" target="_blank" class="btn btn-custom-cta mt-3">
              <i class="bi bi-tiktok"></i> Seguir en Tiktok
            </a>
          </div>
        </div>

      </div>

      <!-- Controles (Visible en Escritorio) -->
      <button class="carousel-control-prev d-none d-md-flex" type="button" data-bs-target="#ctaCarousel"
        data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
      </button>
      <button class="carousel-control-next d-none d-md-flex" type="button" data-bs-target="#ctaCarousel"
        data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
      </button>

    </div>
  </section>

  <!-- Contacto -->
  <section id="contacto" class="contact-section">
    <div class="container">
      <div class="row justify-content-between">
        <div class="col-md-5 mb-4">
          <h3 class="text-warning">Contáctanos</h3>
          <form id="contactForm">
            <div class="mb-3">
              <label for="nombre" class="form-label">Nombre</label>
              <input type="text" class="form-control" id="nombre" placeholder="Tu nombre">
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" placeholder="tu@correo.com">
            </div>
            <div class="mb-3">
              <label for="mensaje" class="form-label">Mensaje <small class="text-white-50 ms-2"></small></label>
              <textarea class="form-control" id="mensaje" rows="4" maxlength="300" style="resize: none;"
                placeholder="Escribe tu mensaje aquí..."></textarea>
              <div class="text-end text-white-50" style="font-size: 0.8rem;"><span id="charCount">0</span>/300</div>
            </div>
            <button type="submit" class="btn btn-warning w-100" id="btnEnviar">Enviar</button>
            <p id="formStatus" class="mt-2 text-white text-center" style="display:none;"></p>
          </form>

          <div class="mt-4 pt-3 border-top border-secondary text-center">
            <h5 class="mb-3 text-white" style="font-family: 'Oswald', sans-serif;">¿Prefieres una respuesta más
              rápida?
            </h5>
            <a href="https://wa.me/56984093394" target="_blank" class="btn btn-outline-warning w-100 fw-bold">
              <i class="bi bi-whatsapp"></i> Contactar por WhatsApp
            </a>
          </div>
        </div>
        <div class="col-md-5">
          <h3 class="text-warning">Información</h3>
          <p><i class="bi bi-geo-alt"></i> Rancagua, Chile</p>
          <p><i class="bi bi-phone"></i> +56 9 8409 3394</p>
          <div class="mt-3">
            <a href="https://www.facebook.com/share/1C2gVS542e/?mibextid=wwXIfr" target="_blank"
              class="text-white me-3"><i class="bi bi-facebook"></i></a>
            <a href="https://www.instagram.com/parrillas_del_gancho?igsh=ZzQxNGdiMnVjZnk4" target="_blank"
              class="text-white me-3"><i class="bi bi-instagram"></i></a>
            <a href="https://www.tiktok.com/@parrillasdelgancho?_r=1&_t=ZS-92kfWrueOyD" target="_blank"
              class="text-white me-3"><i class="bi bi-tiktok"></i></a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <img src="img/logo.png" alt="Parrillas del Gancho Logo" class="navbar-logo img-fluid me-2 mb-3">
    <p>Parrillas del Gancho – Donde nace el fuego del asado</p>
    <p>© 2025 Parrillas del Gancho. Todos los derechos reservados.</p>
    <p class="mt-2" style="font-size: 0.8rem; opacity: 0.7;">
      Creado por <a href="mailto:tugrandesarrollo@gmail.com" class="text-white text-decoration-none fw-bold">Tu Gran
        Desarrollo</a>
    </p>
  </footer>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Modal para Lightbox -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-transparent border-0">
        <div class="modal-body p-0 position-relative">
          <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3 z-3"
            data-bs-dismiss="modal" aria-label="Close"></button>
          <img src="" id="modalImage" class="img-fluid w-100 rounded shadow-lg" alt="Vista ampliada">
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Carga Dinámica de Productos ---
    const API_PRODUCTS_URL = 'http://localhost:3000/api/products';

    document.addEventListener('DOMContentLoaded', loadProducts);

    async function loadProducts() {
      try {
        const res = await fetch(API_PRODUCTS_URL);
        const products = await res.json();

        const parrillasContainer = document.getElementById('parrillas-container');
        const articulosContainer = document.getElementById('articulos-container');

        parrillasContainer.innerHTML = '';
        articulosContainer.innerHTML = '';

        let parrillaCount = 0;

        products.forEach(p => {
          const cardHtml = createProductCard(p);

          if (p.type === 'parrilla') {
            // Lógica para "Ver Más" (mostrar primeros 6, ocultar otros)
            const extraClass = parrillaCount >= 6 ? 'extra-parrilla' : '';
            const displayStyle = parrillaCount >= 6 ? 'style="display:none;"' : '';

            const wrapper = document.createElement('div');
            wrapper.className = `col-md-4 ${extraClass}`;
            if (parrillaCount >= 6) wrapper.style.display = 'none'; // Asegurar que el estilo inline se aplique
            wrapper.innerHTML = cardHtml;
            parrillasContainer.appendChild(wrapper);
            parrillaCount++;
          } else {
            const wrapper = document.createElement('div');
            wrapper.className = 'col-md-4';
            wrapper.innerHTML = cardHtml;
            articulosContainer.appendChild(wrapper);
          }
        });

        // Manejar visibilidad del botón "Ver Más"
        const viewMoreControls = document.getElementById('viewMoreControls');
        if (parrillaCount > 6) {
          viewMoreControls.style.display = 'block';
          setupViewMoreLogic();
        }

        // Re-inicializar Lightbox para nuevas imágenes
        initLightbox();

      } catch (e) {
        console.error("Error loading products:", e);
        document.getElementById('parrillas-container').innerHTML = '<p class="text-white">Error cargando productos.</p>';
      }
    }

    function createProductCard(p) {
      const badgeHtml = p.badge ? `<span class="badge ${p.badge === 'Más vendido' ? 'bg-danger' : 'bg-success'} mb-2">${p.badge}</span>` : '';
      const whatsappMsg = `¡Hola Gancho! Vi el *${p.name}* en su web y me llamó mucho la atención. ¿Me podrían dar más detalles?`;
      const whatsappLink = `https://wa.me/56984093394?text=${encodeURIComponent(whatsappMsg)}`;

      return `
          <div class="card h-100">
            <img src="${p.image}" class="card-img-top product-img" alt="${p.name}">
            <div class="card-body d-flex flex-column">
              <div>
                ${badgeHtml}
                <h5 class="card-title">${p.name}</h5>
                <p class="price-text">${p.price}</p>
                <p class="card-text text-light">${p.description}</p>
              </div>
              <div class="mt-auto pt-3 text-center">
                <a href="${whatsappLink}" target="_blank" class="btn btn-warning btn-sm px-5 fw-bold">Cotizar</a>
              </div>
            </div>
          </div>
        `;
    }

    function setupViewMoreLogic() {
      const btnVerMas = document.getElementById('btnVerMas');
      const btnVerMenos = document.getElementById('btnVerMenos');

      btnVerMas.addEventListener('click', function () {
        document.querySelectorAll('.extra-parrilla').forEach(item => {
          item.style.display = 'block';
          item.style.opacity = 0;
          setTimeout(() => {
            item.style.transition = 'opacity 0.5s';
            item.style.opacity = 1;
          }, 50);
        });
        this.style.display = 'none';
        btnVerMenos.style.display = 'inline-block';
      });

      btnVerMenos.addEventListener('click', function () {
        document.querySelectorAll('.extra-parrilla').forEach(item => {
          item.style.display = 'none';
        });
        this.style.display = 'none';
        btnVerMas.style.display = 'inline-block';
        document.getElementById('parrillas').scrollIntoView({ behavior: 'smooth' });
      });
    }

    function initLightbox() {
      const productImages = document.querySelectorAll('.product-img');
      const modalImage = document.getElementById('modalImage');
      const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));

      productImages.forEach(img => {
        img.addEventListener('click', function () {
          modalImage.src = this.src;
          imageModal.show();
        });
      });
    }
  </script>
  <script>
    // --- Rastreo de Analíticas ---
    const API_TRACK_URL = 'http://localhost:3000/api/track';

    function trackEvent(type, productName = null) {
      console.log('Tracking event:', type, productName);
      // keepalive: true asegura que la petición se envíe aunque se cierre/cambie la página
      fetch(API_TRACK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type, productName }),
        keepalive: true
      }).catch(err => console.warn('Tracking server not reachable', err));
    }

    // 1. Visita de Página (Page View)
    window.addEventListener('load', () => {
      trackEvent('visit');
    });



    // 3. Contacto por Formulario (Correo)
    const contactForm = document.getElementById('contactForm');
    if (contactForm) {
      // Lógica de Conteo de Caracteres
      const msgInput = document.getElementById('mensaje');
      const charCount = document.getElementById('charCount');
      msgInput.addEventListener('input', function () {
        charCount.innerText = this.value.length;
      });

      contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const nombre = document.getElementById('nombre').value;
        const email = document.getElementById('email').value;
        const mensaje = document.getElementById('mensaje').value;
        const statusMsg = document.getElementById('formStatus');
        const btn = document.getElementById('btnEnviar');

        if (!nombre || !email || !mensaje) {
          alert('Por favor completa todos los campos.');
          return;
        }

        btn.disabled = true;
        btn.innerText = 'Enviando...';
        statusMsg.style.display = 'none';

        try {
          const res = await fetch('http://localhost:3000/api/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ nombre, email, mensaje })
          });
          const data = await res.json();

          if (data.success) {
            statusMsg.innerText = '¡Mensaje enviado con éxito!';
            statusMsg.className = 'mt-2 text-success text-center fw-bold';
            statusMsg.style.display = 'block';
            contactForm.reset();
          } else {
            throw new Error(data.message);
          }
        } catch (err) {
          console.error(err);
          statusMsg.innerText = 'Error al enviar. Intenta por WhatsApp.';
          statusMsg.className = 'mt-2 text-danger text-center fw-bold';
          statusMsg.style.display = 'block';
        } finally {
          btn.disabled = false;
          btn.innerText = 'Enviar';
        }
      });
    }

    // 2. Cotizaciones (Delegación de eventos)
    // Escuchar clicks en cualquier parte del documento
    document.addEventListener('click', function (e) {
      // Buscar si el click fue en (o dentro de) un enlace de WhatsApp
      const link = e.target.closest('a[href*="wa.me"]');

      if (link) {
        let productName = 'General'; // Valor por defecto

        // Intentar extraer nombre del producto de la URL si existe el patrón *Nombre*
        try {
          const url = decodeURIComponent(link.href);
          const match = url.match(/\*(.*?)\*/);
          if (match && match[1]) {
            productName = match[1];
          }
        } catch (err) {
          console.warn('Error parsing product name', err);
        }

        // Si el enlace tiene un atributo data-product explícito, usarlo (opcional, por si quieres forzar nombres)
        // if (link.dataset.product) productName = link.dataset.product;

        trackEvent('quote', productName);
      }
    });

    // 4. Redes Sociales
    const socialDomains = ['facebook.com', 'instagram.com', 'tiktok.com'];
    document.querySelectorAll('a').forEach(link => {
      const href = link.href.toLowerCase();
      if (socialDomains.some(domain => href.includes(domain))) {
        link.addEventListener('click', () => {
          trackEvent('social');
        });
      }
    });
  </script>
</body>

</html>